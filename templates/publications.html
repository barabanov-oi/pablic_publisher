{% extends 'base.html' %}
{% block content %}
<h2 class="h3 mb-3">Календарь / Очередь публикаций</h2>
<div class="card border-0 shadow-sm rounded-4">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light"><tr><th>ID</th><th>Post ID</th><th>planned_at UTC</th><th>ready_at UTC</th><th>Статус</th><th>Попытки</th><th>Ошибка</th><th>Действия</th></tr></thead>
      <tbody>
      {% for p in publications %}
        <tr>
          <td>{{ p.id }}</td>
          <td>{{ p.post_id }}</td>
          <td>{{ p.planned_at }}</td>
          <td>{{ p.ready_at }}</td>
          <td><span class="badge status-{{ p.status }}">{{ p.status }}</span></td>
          <td>{{ p.attempts }}</td>
          <td>{{ p.last_error or '' }}</td>
          <td>
            <div class="d-flex flex-wrap gap-2">
              <form method="post" action="{{ url_for('publication_reschedule', pub_id=p.id) }}" class="inline d-flex gap-2">
                <input class="form-control form-control-sm" type="datetime-local" name="planned_at" required>
                <button class="btn btn-outline-primary btn-sm">Перепланировать</button>
              </form>
              <form method="post" action="{{ url_for('publication_retry_now', pub_id=p.id) }}" class="inline">
                <button class="btn btn-outline-secondary btn-sm">Переотправить сейчас</button>
              </form>
            </div>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
