{% extends 'base.html' %}
{% block content %}
<h2 class="h3 mb-3">Отчёты</h2>
<div class="row g-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body border-bottom"><h3 class="h5 mb-0">План/факт</h3></div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light"><tr><th>Publication</th><th>Канал</th><th>Пост</th><th>planned_at (MSK)</th><th>sent_at (MSK)</th><th>Задержка (сек)</th><th>Статус</th></tr></thead>
          <tbody>
          {% for publication, post, channel in rows %}
            <tr>
              <td>{{ publication.id }}</td>
              <td>{{ channel.title }}</td>
              <td>{{ post.title }}</td>
              <td>{{ utc_to_moscow(publication.planned_at) if publication.planned_at else '' }}</td>
              <td>{{ utc_to_moscow(publication.sent_at) if publication.sent_at else '' }}</td>
              <td>{% if publication.sent_at %}{{ (publication.sent_at - publication.planned_at).total_seconds()|int }}{% endif %}</td>
              <td><span class="badge status-{{ publication.status }}">{{ publication.status }}</span></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-12 col-xl-6">
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body border-bottom"><h3 class="h5 mb-0">Топ ошибок</h3></div>
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light"><tr><th>Ошибка</th><th>Кол-во</th></tr></thead>
          <tbody>
          {% for error, count in error_rows %}
            <tr><td>{{ error }}</td><td>{{ count }}</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
